webpackJsonp([5],{ARRY:function(e,t,a){"use strict";function n(e){a("RWiA")}Object.defineProperty(t,"__esModule",{value:!0});var i=a("Xxa5"),r=a.n(i),o=a("exGp"),s=a.n(o),c=a("Dd8w"),h=a.n(c),l=a("NYxO"),d={name:"search",data:function(){return{activeView:"tradition",keyWord:"",loading:!1,keywordHistory:[],searchJson:[],traditionJson:[],traditionProps:{label:"name",children:"data",disabled:function(e){return!e.type}},traditionOpen:[],graphJson:[],graph_tabData:[],graph_activeTab:"",show:{normal:{color:"#00939c",label:{show:!0,position:"left",formatter:"{b}:{c}",textStyle:{color:"#00939c",fontSize:12,fontWeight:"bold"}},lineStyle:{color:"#ccc",type:"curve"}},emphasis:{color:"#d43d3d",label:{show:!1},borderWidth:0}},hide:{normal:{color:"#d43d3d",label:{show:!0,position:"right",formatter:"{b}:{c}",textStyle:{color:"#000",fontSize:12}},lineStyle:{color:"#ccc",type:"curve"}},emphasis:{color:"#00939c",label:{show:!1},borderWidth:0}},normal:{normal:{color:"#00939c",label:{show:!0,position:"right",formatter:"{b}:{c}",textStyle:{color:"#00939c",fontSize:12}},lineStyle:{color:"#ccc",type:"curve"}},emphasis:{color:"#d43d3d",label:{show:!1},borderWidth:0}}}},computed:h()({},Object(l.d)(["task"])),methods:h()({},Object(l.c)(["set_task"]),{get_searchSuggestion:function(e,t){this.sourceObj&&this.sourceObj.cancel(),this.sourceObj=this.$http.CancelToken.source(),this.$http.get("http://api.toutiaojk.com/e/extend/jkh/kw2.php",{cancelToken:this.sourceObj.token,params:{type:"kkey",kword:e}}).then(function(e){t(e.data.data?e.data.data:[])}).catch(function(){t([])})},get_searchResult:function(e){var t=this;return s()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.isHasKeyword()||(t.source&&t.source.cancel(),t.source=t.$http.CancelToken.source(),t.loading=!0,t.graphJson=t.traditionJson=[],t.$http.all([t.get_traditionJson(e),t.get_graphJson(e)]).then(function(){t.keywordHistory.push(e)}));case 1:case"end":return a.stop()}},a,t)}))()},get_traditionJson:function(e){var t=this;return s()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.$http.get("http://api.toutiaojk.com/e/extend/jkh/kw3.php",{cancelToken:t.source.token,params:{type:"mkey",kword:e}}).then(function(e){var a=e.data;a?t.traditionTree_init(a):t.$message.warning("搜索不到，换个词试试"),"tradition"===t.activeView&&(t.loading=!1)}).catch(function(e){t.$http.isCancel(e)?console.log("Request canceled",e.message):(console.log(e),t.loading=!1,t.$message.error("出错错误，请重新尝试"))});case 1:case"end":return a.stop()}},a,t)}))()},get_graphJson:function(e){var t=this;return s()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$http.get("http://api.toutiaojk.com/e/extend/jkh/kw.php",{cancelToken:t.source.token,params:{type:"mkey",kword:e}}).then(function(e){var a=e.data;a?t.graphTree_init(a):t.$message.warning("搜索不到，换个词试试"),"graph"===t.activeView&&(t.loading=!1)}).catch(function(e){t.$http.isCancel(e)?console.log("Request canceled",e.message):(console.log(e),t.loading=!1,t.$message.error("出错错误，请重新尝试"))});case 2:case"end":return a.stop()}},a,t)}))()},isHasKeyword:function(){var e=this;return this.keywordHistory.findIndex(function(t){return t===e.keyWord})>-1&&(this.$message.warning("视图已经存在"),this.graph_activeTab=this.keyWord,!0)},removeKeyword:function(e){var t=this;this.keywordHistory=this.keywordHistory.filter(function(t){return t.name!==e}),this.traditionJson=this.traditionJson.filter(function(t){return t.name!==e}),this.graph_tabData=this.graph_tabData.filter(function(t){return t.name!==e}),this.graph_activeTab===e&&this.graph_tabData.forEach(function(a,n){if(a.name===e){var i=a[n+1]||a[n-1];i&&(t.graph_activeTab=i.name)}})},setTypeDate:function(e){if("tag"===e.type){var t={source:this.keyWord,name:e.name};this.task.tags.push(t)}else if("sentence"===e.type){var a={source:this.keyWord,name:e.name};this.task.sentences.push(a)}else if("article"===e.type){var n={source:this.keyWord,name:e.name,id:e.newsid};this.task.articles.push(n)}this.set_task(this.task)},traditionTree_init:function(e){this.traditionJson.push(e)},getCheckedNodes:function(){var e=this,t=this.$refs.tree.getCheckedNodes();t&&t.length>0&&(t.forEach(function(t,a){e.setTypeDate(t)}),this.$message({message:"添加成功",type:"success",duration:1500}),this.$refs.tree.setCheckedKeys([]))},graphTree_init:function(e){var t=this;this.graphJson=e,this.setStyle(this.graphJson),this.graph_tabData.push({label:this.keyWord,name:this.keyWord}),this.graph_activeTab=this.keyWord,this.$nextTick(function(){t.drawTree(t.keyWord)})},drawTree:function(e){var t=this,a=echarts.init(this.$el.querySelector("#"+e));a.setOption({tooltip:{trigger:"item",formatter:function(e){return e.data.hot?"热度: "+e.data.hot:"热度: 0"}},series:[{name:"节点关系",type:"tree",data:[this.graphJson],symbolSize:10,roam:!0,orient:"horizontal",rootLocation:{x:50,y:"center"},nodePadding:8,layerPadding:200,hoverable:!1,itemStyle:{normal:{color:"#00939c",label:{show:!0,position:"right",formatter:"{b}:{c}",textStyle:{color:"#000",fontSize:12}},lineStyle:{color:"#ccc",type:"curve"}},emphasis:{color:"#00939c",label:{show:!1},borderWidth:0}},z:2}]}),a.on("click",function(e){clearTimeout(t.timer),t.timer=setTimeout(function(){var n=e.data;n.children&&n.children.length>0?(n.hide=n.children,n.children=[],n.itemStyle=t.hide,a.refresh()):n.hide&&n.hide.length>0&&(n.children=n.hide,n.hide=[],n.itemStyle=t.show,a.refresh())},300)}),a.on("dblclick",function(e){clearTimeout(t.timer);var a=e.data;t.setTypeDate(a),t.$message({message:"添加成功",type:"success",duration:1500})})},setStyle:function(e){var t=this;e.children?(e.itemStyle=this.show,e.children.forEach(function(e,a){t.setStyle(e)})):e.hide?(e.itemStyle=this.hide,e.hide.forEach(function(e,a){t.setStyle(e)})):e.itemStyle=this.normal}})},p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:"search","element-loading-text":"正在加载中"}},[a("el-tabs",{staticClass:"tab_main",model:{value:e.activeView,callback:function(t){e.activeView=t},expression:"activeView"}},[a("el-tab-pane",{staticClass:"tab_tradition",attrs:{label:"传统视图",name:"tradition"}},[a("el-button",{staticClass:"addBtn",attrs:{type:"primary",icon:"plus"},on:{click:e.getCheckedNodes}},[e._v("将选中项添加到素材库")]),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.traditionJson,props:e.traditionProps,"show-checkbox":!0,"check-strictly":!0,"highlight-current":!0,"default-expanded-keys":e.traditionOpen,"node-key":"id"}})],1),e._v(" "),a("el-tab-pane",{staticClass:"tab_graph",attrs:{label:"图形视图",name:"graph"}},[a("el-tabs",{directives:[{name:"show",rawName:"v-show",value:e.graph_tabData.length>0,expression:"graph_tabData.length > 0"}],staticClass:"tab_sub",attrs:{type:"card",closable:""},on:{"tab-remove":e.removeKeyword},model:{value:e.graph_activeTab,callback:function(t){e.graph_activeTab=t},expression:"graph_activeTab"}},e._l(e.graph_tabData,function(e,t){return a("el-tab-pane",{key:t,attrs:{label:e.label,name:e.name}},[a("div",{staticClass:"myChart",staticStyle:{width:"934px",height:"800px"},attrs:{id:e.name}})])})),e._v(" "),e.graph_tabData.length>0?e._e():a("el-alert",{staticClass:"userTip",attrs:{"show-icon":"",type:"info",title:"使用提示：1、右上角搜索绘制图表  2、单击展开节点  3、双击选取节点"}})],1)],1),e._v(" "),a("div",{staticClass:"searchInput"},[a("el-autocomplete",{attrs:{size:"small","trigger-on-focus":!1,"select-when-unmatched":!0,"fetch-suggestions":e.get_searchSuggestion,placeholder:"请输入内容"},on:{select:function(t){return e.get_searchResult(t.value)}},model:{value:e.keyWord,callback:function(t){e.keyWord="string"==typeof t?t.trim():t},expression:"keyWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},nativeOn:{click:function(t){t.stopPropagation(),e.get_searchResult(e.keyWord)}},slot:"append"})],1)],1)],1)},u=[],g={render:p,staticRenderFns:u},m=g,f=a("VU/8"),b=n,y=f(d,m,!1,b,null,null);t.default=y.exports},RWiA:function(e,t,a){var n=a("zvJY");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("6fc21cfe",n,!0)},zvJY:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,"\n#search {\n  position: relative;\n  width: 100%;\n  min-height: inherit;\n}\n#search .searchInput {\n  position: absolute;\n  top: 20px;\n  right: 24px;\n}\n#search .el-tabs__nav-wrap.is-scrollable {\n  padding: 0 20px;\n}\n#search .tab_graph {\n  width: 900px;\n}\n#search .tab_graph .myChart {\n  position: relative;\n  width: 100%;\n  height: 800px;\n}\n#search .tab_graph .userTip {\n  margin: 20px 24px;\n  width: 60%;\n}\n#search .tab_tradition {\n  padding: 20px 24px;\n}\n#search .tab_tradition .addBtn {\n  margin-bottom: 30px;\n}\n#search .tab_tradition .el-tree-node {\n  white-space: normal;\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n#search .tab_tradition .el-tree-node .el-tree-node__content {\n  height: auto;\n  line-height: 1.7;\n}\n#search .tab_tradition .el-tree-node .el-tree-node__content .el-tree-node__expand-icon {\n  vertical-align: middle;\n}\n#search .tab_tradition .el-tree-node__content>.el-checkbox {\n  vertical-align: top;\n}\n#search .tab_tradition .el-tree-node__label {\n  width: 90%;\n  text-indent: -4em;\n  padding-left: 4em;\n  vertical-align: top;\n}\n",""])}});